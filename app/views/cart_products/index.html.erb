<h2>ショッピングカート</h2>

<%= link_to 'カートを空にする', destroy_all_cart_products_path, method: :delete, class: 'btn btn-danger' %>

<table>
	<thead>
		<tr>
			<th>商品名</th>
			<th>単価（税込）</th>
			<th>数量</th>
			<th>小計</th>
			<th></th>
		</tr>
	</thead>
	<% sum = 0 %>
	<% @cart_products.each do |cart_product| %>
	<tbody>
		<tr>
			<td>cart_product.product.name</td>
			<td>cart_product.product.price</td>
			<td>price_include_tax(cart_product.product.price)</td>
			<td>
				<%= form_with model: cart_product, local: true do |f| %>
        		<%= f.number_field :count, value: cart_product.count, min:1, max:99  %>
        		<%= f.submit "変更", class: "btn btn-primary" %>
        		<% end %>
			</td>
			<td>
				<% sub_total = price_include_tax(cart_product.product.price).to_i * cart_product.count %>
				<% sum+=sub_total %>
				<%= sub_total %>
			</td>
			<td>

				<%= link_to "削除する", cart_product_path(cart_product), method: :delete, class: "btn btn-danger"%>
			</td>
		</tr>
	</tbody>
	<% end %>
</table>
<table>
	<tbody>
		<tr>
			<th>合計金額</th>
			<td>
				<%= sum %>
				</td>
		</tr>
	</tbody>
</table>

<%= link_to "買い物を続ける", root_path, class: "btn btn-danger "%>

<%= link_to "情報入力に進む", new_order_path, class: "btn btn-danger btn-lg" %>